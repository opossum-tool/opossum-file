<!--
SPDX-FileCopyrightText: TNG Technology Consulting GmbH <https://www.tngtech.com>

SPDX-License-Identifier: Apache-2.0
-->

# opossum-file

[![REUSE status](https://api.reuse.software/badge/git.fsfe.org/reuse/api)](https://api.reuse.software/info/git.fsfe.org/reuse/api)
[![GitHub release (latest by date)](https://img.shields.io/github/v/release/opossum-tool/opossum-file)](https://github.com/opossum-tool/opossum-file/releases/latest)
![Lint and test](https://github.com/opossum-tool/opossum-file/actions/workflows/lint_and_run_tests.yml/badge.svg)
![build workflow](https://github.com/opossum-tool/opossum-file/actions/workflows/build-and-e2e-test.yml/badge.svg)

This is a library implementing operations around files readable by [OpossumUI](https://github.com/opossum-tool/OpossumUI/).
Currently only supports conversion from single SPDX files to `.opossum` format.

# Current state

This is a work in progress and not yet stable.

# License

[Apache-2.0](LICENSE)

# Installation

This package uses [uv](https://docs.astral.sh/uv/) for installation and dependency management.
After installing uv, you can set up the project with

```bash
uv sync
```

# How to use

## Command-line usage
The CLI uses subcommands. The main command just displays all available subcommands
```bash
Usage: uv run opossum-file [OPTIONS] COMMAND [ARGS]...

Options:
  --help  Show this message and exit.

Commands:
  generate  Generate an Opossum file from various other file formats.
```

### generate

```bash
Usage: opossum-file generate [OPTIONS]

  Generate an Opossum file from various other file formats.

  Currently supported input formats:
    - ScanCode
    - Opossum

Options:
  --opossum PATH         Specify a path to a .opossum file that you would like
                         to include in the final output. Option can be
                         repeated.
  --scan-code-json PATH  Specify a path to a .json file generated by ScanCode
                         that you would like to include in the final output.
                         Option can be repeated.
  -o, --outfile TEXT     The file path to write the generated opossum document
                         to. If appropriate, the extension ".opossum" will be
                         appended.  [default: output.opossum]
  --help                 Show this message and exit.


```

# Development

To test your changes, run

```bash
uv run ruff check
uv run ruff format --check
uv run python -m mypy src/ tests/
uv run pytest
```

# Build

To build, run

```bash
uv run python build.py opossum-file
```

This will create a self-contained executable file `dist/opossum-file` (`dist/opossum-file.exe` on Windows).

# Test
* This project uses [faker](https://faker.readthedocs.io/en/master/) for testing
* By default, every test runs with a different seed
* To fix the seed, just adapt the line in faker_setup.py (without committing)

# Creating a new release

Note: You will need the "maintain" role in order to create a new release.

1. Go to the [GitHub releases page](https://github.com/opossum-tool/opossum-file/releases/new) and use the UI to create a new release.
2. The tag should have the format "opossum-file-$YEAR-$MONTH-$DAY" (in case of an Nth release on the same day "opossum-file-$YEAR-$MONTH-$DAY.N").
3. The title of the release equals the tag.
4. Click the button "Generate release notes" to get the description for the release. Then, remove all the contributions from @renovate which are just dependency upgrades.
5. Click "Publish release". This will trigger the CI/CD pipeline which will build the release for all three OSs and upload the artifacts to the release.